---
import LayoutAdmin from '../../layouts/LayoutAdmin.astro'
import MapAdd from '../../components/icons/MapAdd.astro'
import Main from '../../components/Main.astro'
import { AddRoute } from '../../components/AddRoute.jsx'
import MainTitle from '../../components/MainTitle.astro'
import { getAuth } from 'firebase-admin/auth'
import { app } from '../../lib/firebase/server'
import { ListRoutes } from '../../components/ListRoutes'
const auth = getAuth(app)
export const prerender = false
/* Check current session */
if (!Astro.cookies.has('__session')) {
  return Astro.redirect('/signin')
}

const sessionCookie = Astro.cookies.get('__session')?.value

if (!sessionCookie) {
  return Astro.redirect('/signin')
}
const decodedCookie = await auth.verifySessionCookie(sessionCookie)
---

<LayoutAdmin>
  <Main
    class='relative overflow-hidden bg-azur-200/20 p-4 md:p-6 flex flex-col gap-4 md:gap-6 pb-16 sm:pb-6'
  >
    <MainTitle title='Lista de rutas' />

    <section class='flex justify-between gap-x-2 items-center'>
      <button
        id='open-modal'
        class='flex items-center gap-x-1 bg-azur-600 text-azur-50/80 border rounded-xl py-2 px-4 hover:bg-azur-800 hover:text-azur-50'
      >
        <MapAdd />
        Agregar
      </button>
    </section>
    <section>
      <ListRoutes uid={decodedCookie.uid} client:load />
    </section>
    <AddRoute uid={decodedCookie.uid} client:load />
  </Main>
</LayoutAdmin>
<script>
  const $openModal = document.getElementById('open-modal')
  const $closeModal = document.getElementById('close-modal')
  const $modal = document.getElementById('modal-add-route')

  $openModal?.addEventListener('click', () => {
    $modal?.classList.remove('hidden')
  })
  $closeModal?.addEventListener('click', () => {
    $modal?.classList.add('hidden')
  })
</script>
